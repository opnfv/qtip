---
- name: pulling elasticsearch and kibana
  become: true
  docker_image: name={{ item }} state=present
  with_items:
    - elasticsearch
    - kibana

- name: setting up elasticsearch
  become: true
  docker_container:
    name: esearch
    image: elasticsearch
    published_ports: 9200:9200

- name: setting up kibana
  become: true
  docker_container:
    name: kibana
    image: kibana
    published_ports: 5601:5601
    links: esearch:elasticsearch

- name: nginx is installed
  become: true
  package: name=nginx state=present
- name: qtip server configuration is generated
  become: true
  template: src={{ item }}.conf.j2 dest=/etc/nginx/sites-enabled/{{ item }}.conf
  with_items:
    - elk
  notify:
    - restart nginx
