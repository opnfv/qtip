##############################################################################
# Copyright (c) 2017 ZTE Corporation and others.
#
# All rights reserved. This program and the accompanying materials
# are made available under the terms of the Apache License, Version 2.0
# which accompanies this distribution, and is available at
# http://www.apache.org/licenses/LICENSE-2.0
##############################################################################

---
- hosts: fuel-master
  gather_facts: no
  tasks:
  - name: collect facts of fuel hosts
    fuel:
  - name: add compute node to ansible inventory
    add_host:
      name: "{{ hosts_meta[item]['ip'] }}"
      groups: compute
      ansible_user: root
      ansible_ssh_common_args: '-o StrictHostKeyChecking=No -o ProxyJump=fuel-master'
    with_items: "{{ hosts.compute }}"
- hosts: compute
  tasks:
  - name: check ssh connection
    ping:
  - include: tasks/inxi.yaml
- hosts: local
  tasks:
  - name: create system information report
    local_action: template src=templates/inxi-system-info.j2 dest=reports/inxi-system-info
    delegate_to: localhost
