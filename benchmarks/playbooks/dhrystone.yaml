 
 - hosts:  "{{ role }}"

   tasks:
    - name: cleaning
      file: path=/root/tempT  state=absent
    - name: cleaning results
      file: path=/root/results state=absent
    - name: Installing UnixBench dependencies
      shell: yum install git gcc  patch perl-Time-HiRes -y
    - name: Clone unixbench
      shell: git clone https://github.com/kdlucas/byte-unixbench.git /root/tempT
    - name: make
      shell: make --directory /root/tempT/UnixBench/
    - name: downloading_patch
      shell: cd /root/tempT/UnixBench/ && wget https://www.dropbox.com/s/11z85gfu0trkhus/fix-limitation.patch
    - name: applying_patch
      shell: cd /root/tempT/UnixBench/ &&  patch Run fix-limitation.patch
    - name: Run dhrystone
      shell: cd /root/tempT/UnixBench/&&./Run -v dhrystone
    - name: making directory
      file: path=/root/results state=directory
    - name: copying result to temp directory
      shell: cp -r /root/tempT/UnixBench/results/* /root/results/
    - name: registering files
      shell: (cd /root/results/; find . -maxdepth 1 -type f) | cut -d'/' -f2
      register: files_to_copy
    - name: copy results
      fetch:  src=/root/results/{{item}} dest={{Dest_dir}}/dhrystone
      with_items: files_to_copy.stdout_lines 

